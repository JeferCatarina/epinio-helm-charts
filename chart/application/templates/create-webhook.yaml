apiVersion: tekton.dev/v1beta1
kind: TaskRun
metadata:
  name: {{ .Release.Name }}-cr-whook
  labels:
    {{- range $key, $value := .Values.labels }}
    {{ $key }}: {{ $value | quote }} 
    {{- end }}
    {{- include "pr-preview.labels" . | nindent 4 }}
spec:
  taskRef:
    name: create-webhook-{{ .Release.Name }}
  params:
  - name: GitHubRepo
    value: {{ .Values.GithubRepo }}
  - name: GitHubOrg
    value: {{ .Values.GithubOrganization }}
  - name: GitHubUser
    value: {{ .Values.GithubUsername }}
  - name: GitHubAccessToken
    value: {{ .Values.GithubWebhookToken }}
  - name: ExternalDomain
    value: {{ .Release.Name }}.epinio.demo.stack.io
  timeout: 1000s
  serviceAccountName: {{ .Release.Name }}-createwebhook
{{- end }}