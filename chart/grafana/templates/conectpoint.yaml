{{- if .Values.slack.url }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ include "grafana.fullname" . }}-provisioning-alerting"
  labels:
    {{- include "grafana.labels" . | nindent 4 }}
data:
  notification-policies.yaml: |
    apiVersion: 1
    policies:
      - orgId: 1
        receiver: slack
        group_by:
          - grafana_folder
          - alertname
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaContactPoint
metadata:
  name: "{{ include "grafana.fullname" . }}"
  labels:
    {{- include "grafana.labels" . | nindent 4 }}
spec:
  name: slack
  instanceSelector:
    matchLabels:
      {{- include "grafana.labels" . | nindent 6 }}
  type: slack
  settings:
    {{- with .Values.slack.mentionChannel }}
    mentionChannel: here
    {{- end }}
    url: {{ .Values.slack.url }}
{{- end }}
