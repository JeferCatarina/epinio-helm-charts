---
title: "Bump epinio-installer Helm Chart"
# Define git repository configuration to know where to push changes
scms:
  helm-charts:
    kind: "github"
    spec:
      user: "{{ .github.epinio.user }}"
      email: "{{ .github.epinio.email }}"
      owner: "{{ .github.epinio.owner }}"
      repository: "{{ .github.epinio.repository }}"
      token: "{{ requiredEnv .github.epinio.token }}"
      username: "{{ .github.epinio.username }}"
      branch: "{{ .github.epinio.branch }}"

# Define pullrequest configuration if one needs to be created
pullrequests:
  helm-charts:
    kind: "github"
    scmid: "helm-charts"
    targets:
      - "helm-charts"
    spec:
      labels:
        - "dependencies"
        - "epinio-installer"

# Defines where we get source values
sources:
  epinio-installer:
    name: "Get Latest epinio-installer app version"
    kind: "githubRelease"
    spec:
      owner: "epinio"
      repository: "installer"
      username: '{{ requiredEnv .github.epinio.username }}'
      token: '{{ requiredEnv .github.epinio.token }}'
  helm-charts:
    name: "Get Latest Epinio Helm chart version"
    kind: "helmChart"
    spec:
      url: "https://epinio.github.io/helm-charts"
      name: "epinio"

## Defines condition that must pass in order to update targets
# Commented for now until we put the right credential
#conditions:
#  dockerImage:
#    name: 'Check that splatform/epinio-installer:{{ source "epinio-installer" }} is published'
#    kind: "dockerImage"
#    sourceID: "epinio-installer"
#    spec:
#      image: "ghcr.io/epinio/epinio-installer"
#      token : '{{/* requiredEnv "UPDATECLI_GHCR_TOKEN" */}}'

# Defines what need to be udpated if needed
targets:
#  epinio-installer:
#  Commented for now until we parametrize the container configuration in the chart epinio-installer
#    name: "Update epinio version in chart epinio"
#    kind: "helmChart"
#    scmID: "helm-charts"
#    sourceID: "epinio"
#    spec:
#      appVersion: true
#      name: "chart/epinio-installer"
#      file: "values.yaml"
#      key: "container.tag"
  epinio-installer-helm-charts:
    name: "Update epinio chart version in Helm chart epinio-installer"
    kind: "helmChart"
    scmID: "helm-charts"
    sourceID: "helm-charts"
    spec:
      name: "chart/epinio-installer"
      file: "values.yaml"
      key: "epinioChart"
      value: 'https://github.com/epinio/helm-charts/releases/download/epinio-{{ source "helm-charts" }}/epinio-{{ source "helm-charts" }}.tgz'
